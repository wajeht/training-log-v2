<!-- spinner -->
<%- include('../partials/spinner.ejs') %>

<!-- video details -->
<!-- min-vh-100 bug for hiding footer when reloading -->
<section id="single-video-page" class="px-4 py-5 min-vh-100">
  <div class="container">
    <div class="row gy-3 position-relative">
      <!-- main video -->
      <div class="col-lg-9 col-sm-12">
        <div id="video-card<%= videoDetails.id %>" class="card shadow-sm">
          <video
            controls
            preload="none"
            poster="<%= videoDetails.screenshot_url %>"
          >
            <source src="<%= videoDetails.video_url %> " type="video/mp4" />
          </video>

          <div class="card-body">
            <h5 class="card-title"><%= videoDetails.title %></h5>
            <p class="card-text"><%= videoDetails.description %></p>
            <p class="card-text">
              <small class="text-muted">Last updated 3 mins ago</small>
            </p>
          </div>
          <div
            class="
              card-footer
              text-muted
              d-flex
              gap-2
              justify-content-between
              align-items-center
            "
          >
            <!-- post author details -->
            <div class="d-flex gap-3 justify-content-center align-items-center">
              <a
                href="/users/<%= videoDetails.username  %> "
                class="
                  d-inline-block
                  link-secondary
                  text-decoration-none
                  align-text-top
                "
              >
                <img
                  src="<%= videoDetails.profile_picture_url %> "
                  alt="mdo"
                  width="25"
                  height="25"
                  class="rounded-circle"
                />
                <%= videoDetails.username %>
              </a>
              <a href="#" class="link-secondary text-decoration-none"
                ><i class="bi bi-calendar-minus"></i> <%=
                videoDetails.date.toLocaleDateString() %></a
              >
            </div>

            <!-- edit and delete -->
            <% if ( isAuthenticated && (user.id == videoDetails.user_id)) { %>
            <div class="d-flex gap-3 justify-content-center align-items-center">
              <input
                type="hidden"
                name="userId"
                id="userId"
                value="<%= videoDetails.user_id %>"
              />
              <input
                type="hidden"
                id="csrfToken"
                name="_csrf"
                value="<%= csrfToken %>"
              />
              <a href="#" class="link-secondary text-decoration-none"
                ><i class="bi bi-pencil"></i
              ></a>
              <a
                href="#"
                data-bs-toggle="modal"
                data-bs-target="#deleteConfirmation"
                id="delete-button"
                class="link-secondary text-decoration-none"
                ><i class="bi bi-trash"></i
              ></a>
            </div>
            <% } %>
          </div>
        </div>
      </div>

      <!-- user's comment -->
      <%- include('../partials/auth/videos-comments.ejs') %>

      <!-- sign in to comment -->
      <%- include('../partials/auth/post-a-comment.ejs') %>

      <!-- recent video collection -->
      <%- include('../partials/recent-videos.ejs') %>
    </div>
  </div>
</section>
